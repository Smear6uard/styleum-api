[build]
builder = "nixpacks"

[deploy]
startCommand = "npm start"
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# 3:30 AM UTC - Pre-generate outfits for all users
[[crons]]
schedule = "30 3 * * *"
endpoint = "https://${{RAILWAY_PUBLIC_DOMAIN}}/cron/pre-generate"
headers = { authorization = "Bearer ${{CRON_SECRET}}" }

# Every hour - Deliver outfits based on user timezone
[[crons]]
schedule = "0 * * * *"
endpoint = "https://${{RAILWAY_PUBLIC_DOMAIN}}/cron/deliver-outfits"
headers = { authorization = "Bearer ${{CRON_SECRET}}" }

# 9AM US Eastern = 2PM UTC (legacy, can be removed once delivery cron is working)
[[crons]]
schedule = "0 14 * * *"
endpoint = "https://${{RAILWAY_PUBLIC_DOMAIN}}/cron/morning-notifications"
headers = { authorization = "Bearer ${{CRON_SECRET}}" }

# Midnight UTC daily - gamification reset (XP, streaks, challenges)
[[crons]]
schedule = "0 0 * * *"
endpoint = "https://${{RAILWAY_PUBLIC_DOMAIN}}/cron/daily-gamification-reset"
headers = { authorization = "Bearer ${{CRON_SECRET}}" }
